#!/usr/bin/env bash
# NAI Workbench service health check
set -uo pipefail

echo "=== NAI WORKBENCH STATUS ==="
echo ""

PASS=0
FAIL=0

check() {
  local name="$1"
  local port="$2"
  local code
  code=$(curl -s -o /dev/null -w '%{http_code}' "http://localhost:$port" 2>/dev/null)
  if [ "$code" = "200" ] || [ "$code" = "302" ]; then
    printf "  %-25s :%-5s UP\n" "$name" "$port"
    PASS=$((PASS + 1))
  else
    printf "  %-25s :%-5s DOWN (HTTP %s)\n" "$name" "$port" "$code"
    FAIL=$((FAIL + 1))
  fi
}

check "Excalidraw (Whiteboard)" 9081
check "Komodo (Dashboard)" 9090
check "code-server (Editor)" 9091

echo ""
echo "  Docker containers:"
docker ps --format '    {{.Names}}: {{.Status}}' 2>/dev/null || echo "    Docker not running"

echo ""
echo "  Results: $PASS up, $FAIL down"
echo "==========================="
